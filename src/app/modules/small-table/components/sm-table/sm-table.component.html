<!--Container that contains the main table-->
<dts-select-container #container="dts-select-container"
                      [(selectedItems)]="selectedDocuments"
                      [selectWithShortcut]="true">
  <div class="container">
    <div class="basic-container">
        <table>
          <tr>
            <th *ngFor="let col of columnNames; let i=index">
              <div style="margin-top: 10px; display: inline-block; cursor:pointer;" *ngIf="(!searchMode && col === 'Tests') || col !== 'Tests'"
                   (click)="changeSortingOrder(i)">
                {{col}}
                <span style="margin-left: 10px">{{sortingOrder[i] === undefined || sortingOrder[i] === null? sortingOrder[i]="▼" : sortingOrder[i]}}</span>
              </div>
              <img *ngIf="!searchMode && col === 'Tests'" (click)="enableSearchMode()"
                   src="./assets/images/search.png"
                   style="width: 25px; float: right; padding-top: 10px">
              <!--Input for search-->
              <form *ngIf="searchMode && col === 'Tests'" id="search">
                <span style="float: right; font-size: large; cursor: pointer; margin-top: 8px; margin-right: 10px"
                      (click)="disableSearchMode()"
                      *ngIf="searchMode && col === 'Tests'">×</span>
                <input type="text" placeholder="Test Name" name="myInput" [(ngModel)]="curInput" (keyup)="applyChange()">
              </form>
            </th>
          </tr>
          <tr *ngFor="let row of filteredTable; let i = index"
              [dtsSelectItem]="row" #item>
            <td [contextMenu]="testMenu"
                [contextMenuSubject]="row['Tests']"
                (contextmenu)="setTestSelected(i)"
                [ngClass]="selectedDocuments.length === 0 && isTestSelected[i] === true? 'selected-cell' : ''">
              {{row["Tests"]}}
            </td>
            <td class="{{item['Status']}}"
                *ngFor="let item of row['Data']; let j=index"
                [contextMenu]="statusMenu"
                [contextMenuSubject]="{'index': j, 'cur': item, 'test': row['Tests']}"
                (contextmenu)="setStatusSelected(i, j)"
                [ngClass]="selectedDocuments.length === 0 && isStatusSelected[i] !== undefined && isStatusSelected[i][j] === true? 'selected-cell' : ''">
              <span>{{item["Status"]}}</span>
              <br><br>
              <span *ngIf="item['fStatus'][0] === '---'">---</span>
              <ul *ngIf="item['fStatus'][0] !== '---'">
                <li *ngFor="let f_s of item['fStatus']">{{f_s}}</li>
              </ul>
            </td>
          </tr>
        </table>
    </div>
  </div>
</dts-select-container>
<!-- Context Menu for test name -->

<context-menu #testMenu (close)="isTestSelected = []">
  <ng-template *ngIf="selectedDocuments.length > 0"
               contextMenuItem
               (execute)="showMessage('Hi, ' + $event)"
               [subMenu]="subTestMenu"
               let-item>
    Cur Selected: {{item}}
  </ng-template>
  <ng-template *ngIf="selectedDocuments.length === 0"
               contextMenuItem
               let-item>
    Cur Selected: {{item}}
  </ng-template>
  <context-menu #subTestMenu>
    <ng-template contextMenuItem
                 (execute)="showMessage('Hi, ' + $event.item)"
                 *ngFor="let doc of selectedDocuments; let i = index">
      Item {{i+1}}: {{doc['Tests']}}
    </ng-template>
  </context-menu>
  <ng-template contextMenuItem let-item (execute)="showPopUpTable(selectedDocuments.length === 0? $event.item : selectedDocuments[0]['Tests'])">Show More Info</ng-template>
</context-menu>

<!--Context menu for status-->
<context-menu #statusMenu (close)="isStatusSelected = []">
  <ng-template *ngIf="selectedDocuments.length > 0"
               contextMenuItem
               (execute)="showMessage('Hi, ' + $event.item)"
               [subMenu]="subStatusMenu"
               let-data>
    Cur Selected: {{data['cur']['Status']}}
  </ng-template>
  <ng-template *ngIf="selectedDocuments.length === 0"
               contextMenuItem
               let-data>
    Cur Selected: {{data['cur']['Status']}}
  </ng-template>
  <context-menu #subStatusMenu>
    <ng-template contextMenuItem
                 (execute)="showMessage('Hi, ' + $event.item)"
                 *ngFor="let doc of selectedDocuments; let i = index"
                 let-data>
      Item {{i+1}}: {{doc['Data'][ data['index'] ]['Status']}}
    </ng-template>
  </context-menu>
  <ng-template contextMenuItem
               let-data
               (execute)="showPopUpTable(selectedDocuments.length === 0? $event.item['test'] : selectedDocuments[0]['Tests'])">Show More Info</ng-template>
</context-menu>

<!--It's just the dark window that appears behind the pop up table-->
<div id="whole-window"
     *ngIf="isSubTableVisible"
     (click)="hideAllPopUps()"></div>

<!--The table in which all information of the row appears-->
<div class="small-container" *ngIf="isSubTableVisible">
  <div class="nav-table">
    <div id="controls">
      <h2>More Information</h2>
      <span (click)="hideAllPopUps()">×</span>
    </div>
    <div class="pagination">
        <div class="item"
             *ngFor="let cur_tab of tabs"
             (click)="selectTab(cur_tab['testName'], {'i': cur_tab.i, 'j': cur_tab.j})"
             [ngClass]="selectedTab.i === cur_tab.i && selectedTab.j === cur_tab.j? 'active-tab':''">
          {{cur_tab.val}}
        </div>
    </div>
  </div>
  <table style="margin-top: 90px">
    <tr *ngFor="let col of allColumnData">
      <th> {{col}} </th>
      <td>
        {{curRow[selectedTab.j][col] === undefined || curRow[selectedTab.j][col] === null? "---" : curRow[selectedTab.j][col]}}</td>
    </tr>
  </table>
</div>
